{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "df36bfa7_65435ed3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2022-11-09T21:51:00Z",
      "side": 1,
      "message": "This seems like the wrong thing to have done.  Why didn\u0027t we keep them both size_t?",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 16,
        "endChar": 120
      },
      "revId": "b40ea0f0ab94d8c44aad498e150930ddba6667f4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "53859261_8e87c589",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-11-10T02:24:24Z",
      "side": 1,
      "message": "That\u0027s why change to use uint32_t instead size_t. Below is commit for refer it. https://gerrit.openbmc.org/c/openbmc/phosphor-host-ipmid/+/56296\n\nThe issue error message \"Authenticated message doesn\u0027t match\" from encryptDecryptData() in ipmid will not print it by default that use log\u003clevel::DEBUG\u003e. When I change log level to log\u003clevel::ERR\u003e then I found those error message and there is the same struct metapassstruct definition between ipmid and pam-ipmi, but member type didn\u0027t sync well. After sync pam-ipmi to ipmid, error message was gone.\n\nipmid:\nstruct MetaPassStruct\n{\n    char signature[10];\n    unsigned char reseved[2];\n    uint32_t hashSize;\n    uint32_t ivSize;\n    uint32_t dataSize;\n    uint32_t padSize;\n    uint32_t macSize;\n};\n\npam-ipmi:\ntypedef struct metapassstruct {\n    char signature[10];\n    unsigned char reseved[2];\n    size_t hashsize;\n    size_t ivsize;\n    size_t datasize;\n    size_t padsize;\n    size_t macsize;\n} metapassstruct;",
      "parentUuid": "df36bfa7_65435ed3",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 16,
        "endChar": 120
      },
      "revId": "b40ea0f0ab94d8c44aad498e150930ddba6667f4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "39a3e4f9_cf70881a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2022-11-10T18:00:45Z",
      "side": 1,
      "message": "Shouldn\u0027t we revert the host-ipmid one?  I don\u0027t really understand why we made the ipmid one uint32_t but that doesn\u0027t seem right.",
      "parentUuid": "53859261_8e87c589",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 16,
        "endChar": 120
      },
      "revId": "b40ea0f0ab94d8c44aad498e150930ddba6667f4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7be70415_618e22d8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-11-11T01:48:35Z",
      "side": 1,
      "message": "We cannot revert the host-ipmid one, due to there is SEGV then cause ipmid crash.\nI just revert it to size_t and make sure the SEGV symptom still exist with latest ipmid and pam-ipmi as below:\n\nRevert to size_t in ipmid/user_channel/passwd_mgr.cpp\nstruct MetaPassStruct\n{\n    char signature[10];\n    unsigned char reseved[2];\n    size_t hashSize;\n    size_t ivSize;\n    size_t dataSize;\n    size_t padSize;\n    size_t macSize;\n};\n\nAfter flashing image and boot to openbmc prompt then find ipmid service was crash.\n\nroot@evb-npcm845:~# systemctl status phosphor-ipmi-host.service\nx phosphor-ipmi-host.service - Phosphor Inband IPMI\n     Loaded: loaded (/lib/systemd/system/phosphor-ipmi-host.service; enabled; preset: enabled)\n    Drop-In: /lib/systemd/system/phosphor-ipmi-host.service.d\n             `-10-override.conf\n     Active: failed (Result: core-dump) since Thu 1970-01-01 00:00:22 UTC; 2min 57s ago\n   Duration: 989ms\n    Process: 606 ExecStart\u003d/usr/bin/env ipmid (code\u003ddumped, signal\u003dSEGV)\n   Main PID: 606 (code\u003ddumped, signal\u003dSEGV)\n\nJan 01 00:00:22 evb-npcm845 systemd[1]: Failed to start Phosphor Inband IPMI.",
      "parentUuid": "39a3e4f9_cf70881a",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 16,
        "endChar": 120
      },
      "revId": "b40ea0f0ab94d8c44aad498e150930ddba6667f4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "42698898_9712bf2a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-11-14T04:04:17Z",
      "side": 1,
      "message": "Hi Patrick,\n\nI think you are right, I also don\u0027t understand why host-ipmid need change to use uint32_t instead size_t for fixing ipmid crash issue. Thus, I did some debugging and testing to clarify why didn\u0027t we keep host-ipmid and pam-ipmi both size_t. Yes, they both should keep use size_t and we should revert host-ipmid to use size_t.\n\nI found that real root cause seems relate to this original file /etc/ipmi_pass from pam-ipmi repo. Below is investigation for you refer it.\n\nFirst, I revert host-ipmid to use size_t then I will meet host-ipmid crash issue for sure.\n\nSecond, I keep pam-ipmi use size_t and without install original ipmi_pass file as I submit another commit as below:\nhttps://gerrit.openbmc.org/c/openbmc/pam-ipmi/+/58579\n\nThird, I try to generate new ipmi_pass file by command \"ipmitool user set password 1 0penBmc\" after I flash image-bmc. BTW, this image-bmc that use \"minlen\u003d7\" in common-password that can let us generate \"0penBmc\" this password as default in ipmi_pass file.\n\nAfter that, I replace this ipmi_pass file by bbappend and generate image-bmc again. Then flash this new image-bmc. There is no more ipmid crash issue symptom after device boot up and no more auth failed error messages. However, ipmitool user set password for root also successful as below:\n\nroot@evb-npcm845:~# ipmitool user set password 1 0penBmc0\nSet User Password command successful (user 1)\n\nThus, I will submit one commit to revert host-ipmid this commit https://gerrit.openbmc.org/c/openbmc/phosphor-host-ipmid/+/56296\n\nThen close this commit and update new ipmi_pass file into this commit https://gerrit.openbmc.org/c/openbmc/pam-ipmi/+/58579\n\nIf there is any suggestion, please don\u0027t hestiate to tell me. Thank you.\n\nBest regards,\nTim",
      "parentUuid": "7be70415_618e22d8",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 16,
        "endChar": 120
      },
      "revId": "b40ea0f0ab94d8c44aad498e150930ddba6667f4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d4bbff98_cbdcc61d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2022-11-08T03:51:12Z",
      "side": 1,
      "message": "Dear All,\nCould you please help to review this commit? Thank you.\n\nSincerely,\nTim",
      "revId": "b40ea0f0ab94d8c44aad498e150930ddba6667f4",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}